<% if (tasks.length===0) { %>
  <div class="text-center py-5 text-muted">
    <div class="mb-3" style="font-size: 3rem; opacity: 0.3;"><i class="bi bi-inbox"></i></div>
    <h5 class="fw-bold">No tasks found</h5>
    <p>You're all caught up! or try a different filter.</p>
  </div>
  <% } else { %>
    <div class="d-flex flex-column gap-3">
      <% tasks.forEach(task=> {
        let dueClass = '';
        if (task.due_date && task.status !== 'completed') {
        const today = new Date();
        const due = new Date(task.due_date);
        const isToday = due.toDateString() === today.toDateString();
        const isOverdue = due < today.setHours(0,0,0,0); if (isOverdue) dueClass='task-overdue' ; else if (isToday)
          dueClass='task-today' ; } %>
          <div class="task-row d-flex align-items-center justify-content-between <%= dueClass %>">
            <div class="d-flex align-items-center gap-3">
              <!-- Status Toggle -->
              <form action="/tasks/<%= task.task_id %>/toggle" method="POST" style="margin:0;">
                <input type="hidden" name="status" value="<%= task.status === 'completed' ? 'pending' : 'completed' %>">
                <button type="submit" class="btn p-0 border-0 bg-transparent status-toggle-btn" title="Toggle Status">
                  <% if (task.status==='completed' ) { %>
                    <i class="bi bi-check-circle-fill text-success fs-4"></i>
                    <% } else { %>
                      <i class="bi bi-circle text-muted fs-4"></i>
                      <% } %>
                </button>
              </form>

              <!-- Task Details -->
              <div>
                <a href="/tasks/<%= task.task_id %>"
                  class="text-decoration-none task-title-link <%= task.status === 'completed' ? 'text-decoration-line-through text-muted' : '' %>">
                  <%= task.title %>
                </a>
                <div class="small text-muted d-flex align-items-center gap-2 mt-1">
                  <% if (task.due_date) { %>
                    <span class="task-date">
                      <i class="bi bi-calendar-event me-1"></i>
                      <%= new Date(task.due_date).toLocaleDateString(undefined, { month: 'short' , day: 'numeric' }) %>
                    </span>
                    <% } %>

                      <!-- Priority Badge -->
                      <% let priorityClass='bg-secondary' ; if (task.priority==='High' ) priorityClass='bg-danger' ;
                        else if (task.priority==='Medium' ) priorityClass='bg-primary' ; %>
                        <span
                          class="badge rounded-pill <%= priorityClass %> bg-opacity-10 text-<%= priorityClass.replace('bg-', '') %>"
                          style="font-size: 0.7rem; border: 1px solid currentColor;">
                          <%= task.priority %>
                        </span>
                </div>
              </div>
            </div>

            <!-- Actions -->
            <div class="d-flex gap-2 task-actions">
              <a href="/tasks/<%= task.task_id %>/edit" class="btn btn-sm btn-light text-primary border-0">
                <i class="bi bi-pencil-fill"></i>
              </a>
              <form action="/tasks/<%= task.task_id %>/delete" method="POST" onsubmit="return confirm('Are you sure?');"
                style="margin:0;">
                <button type="submit" class="btn btn-sm btn-light text-danger border-0">
                  <i class="bi bi-trash-fill"></i>
                </button>
              </form>
            </div>
          </div>
          <% }) %>
    </div>
    <% } %>